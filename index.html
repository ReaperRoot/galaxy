<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GALAXY App Store</title>
  <meta name="theme-color" content="#0f0f0f"/>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <style>
    :root{--bg:#0f0f11;--surface:#16171a;--surface-2:#1b1d22;--text:#f5f7fb;--muted:#a2a8b4;--grad:linear-gradient(90deg,#6366f1,#a855f7,#ec4899);--radius:16px;--gap:14px;--pad:16px;}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);line-height:1.5}
    .container{max-width:1100px;margin:0 auto;padding:var(--pad)}

    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
    .brand{font-weight:800;font-size:1.25rem;background:var(--grad);-webkit-background-clip:text;color:transparent}

    .section-head{display:flex;align-items:center;justify-content:space-between;margin:18px 0 12px}
    .section-title{font-size:1.25rem;font-weight:800;position:relative}
    .section-title::after{content:"";display:block;height:2px;width:64px;margin-top:6px;background:var(--grad);border-radius:2px}

    .app-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:var(--gap)}
    .card{position:relative;background:#1c1c21;padding:14px;border-radius:var(--radius);text-align:center;box-shadow:0 8px 22px rgba(0,0,0,.45)}
    .logo{width:76px;height:76px;border-radius:16px;object-fit:cover;border:1px solid rgba(255,255,255,.08);margin:0 auto 10px}
    .name{font-weight:800}
    .meta{font-size:.85rem;color:var(--muted);margin-top:2px}
    .pill{display:inline-block;margin-top:6px;font-size:.72rem;color:#e7e7ea;background:#26283a;padding:4px 8px;border-radius:999px}
    .badge{position:absolute;left:10px;top:10px;font-size:.7rem;background:#26283a;padding:3px 8px;border-radius:999px}
    .btn-dl{display:inline-block;margin-top:10px;padding:8px 14px;border-radius:10px;text-decoration:none;font-weight:800;background:var(--grad);color:#fff}

    .tabs{display:flex;gap:10px;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:14px}
    .tab{flex:1;text-align:center;padding:10px;cursor:pointer;font-weight:600;background:transparent;color:var(--muted)}
    .tab.active{color:#fff;border-bottom:3px solid #6366f1}

    .bottom-nav{position:fixed;bottom:0;left:0;right:0;display:flex;background:#16171a;border-top:1px solid rgba(255,255,255,.1)}
    .nav-btn{flex:1;padding:12px;color:#aaa;font-weight:700;text-align:center;cursor:pointer}
    .nav-btn.active{color:#fff;background:linear-gradient(90deg,#6366f1,#a855f7)}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">GALAXY App Store</div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="for-you">For you</button>
      <button class="tab" data-tab="top-charts">Top charts</button>
      <button class="tab" data-tab="categories">Categories</button>
    </div>

    <!-- Suggested -->
    <section>
      <div class="section-head">
        <div class="section-title">Suggested for you</div>
      </div>
      <div id="suggested-grid" class="app-grid"></div>
    </section>

    <!-- Recommended -->
    <section>
      <div class="section-head">
        <div class="section-title">Recommended for you</div>
      </div>
      <div id="recommended-grid" class="app-grid"></div>
    </section>

    <!-- Main Category -->
    <section>
      <div class="section-head">
        <div class="section-title" id="main-category-title">Games</div>
      </div>
      <div id="app-grid" class="app-grid"></div>
    </section>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <button class="nav-btn active" onclick="renderCategory('games')">Games</button>
    <button class="nav-btn" onclick="renderCategory('apps')">Apps</button>
    <button class="nav-btn" onclick="renderCategory('tools')">Tools</button>
  </nav>

  <script>
    // ===== Firebase Setup =====
    const firebaseConfig = {
      apiKey: "AIzaSyADlc_ZV7vdTQmdrpcYH1tRl05HU-898Kk",
      authDomain: "galaxyapkstore-5fb8a.firebaseapp.com",
      projectId: "galaxyapkstore-5fb8a",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let allApps = [];

    function daysSince(date){ if(!date) return Infinity; const diff=Date.now()-date.getTime(); return Math.floor(diff/86400000); }
    function relDayLabel(date){ const d=daysSince(date); if(d===0) return 'today'; if(d===1) return '1 day ago'; if(d<30) return d+' days ago'; const m=Math.floor(d/30); return m+' months ago'; }

    // Render specific section
    function renderSection(tag, containerId) {
      const filtered = allApps.filter(app => app.tag === tag);
      displayAppsInGrid(filtered, containerId);
    }

    // Render by category
    function renderCategory(category) {
      document.querySelectorAll('.nav-btn').forEach(n=>n.classList.remove('active'));
      document.querySelector(`.nav-btn[onclick="renderCategory('${category}')"]`).classList.add('active');
      document.getElementById('main-category-title').textContent = category.charAt(0).toUpperCase() + category.slice(1);
      const filtered = allApps.filter(app => app.category === category);
      displayAppsInGrid(filtered, 'app-grid');
    }

    // Display apps into grid
    function displayAppsInGrid(apps, containerId) {
      const grid = document.getElementById(containerId);
      grid.innerHTML = '';
      if (apps.length === 0) {
        grid.innerHTML = '<p style="color:#aaa">No apps found</p>';
        return;
      }
      apps.forEach(app => {
        const card = document.createElement('div');
        card.className = 'card';
        const isNew = daysSince(app.updatedAt) <= 14;
        card.innerHTML = `
          ${isNew ? '<span class="badge">NEW</span>' : ''}
          <img src="${app.logoUrl}" class="logo" alt="${app.name} logo">
          <div class="name">${app.name}</div>
          <div class="meta">${app.version} â€¢ ${app.size}</div>
          <div class="pill">${app.category || ''}</div>
          <div class="meta">Updated ${relDayLabel(app.updatedAt)}</div>
          <a class="btn-dl" href="${app.downloadLink}" target="_blank">Download</a>
        `;
        grid.appendChild(card);
      });
    }

    // Load apps from Firestore
    db.collection('apps').onSnapshot(snap => {
      allApps = [];
      snap.forEach(doc => {
        const d = doc.data();
        allApps.push({
          id: doc.id,
          ...d,
          updatedAt: d.updatedAt ? (d.updatedAt.toDate ? d.updatedAt.toDate() : new Date(d.updatedAt)) : null
        });
      });
      // Render sections
      renderSection('suggested', 'suggested-grid');
      renderSection('recommended', 'recommended-grid');
      renderCategory('games'); // default
    });
  </script>
</body>
</html>
