<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GALAXY App Store</title>
  <meta name="theme-color" content="#0f0f0f"/>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <style>
    :root{--bg:#0f0f11;--surface:#16171a;--surface-2:#1b1d22;--text:#f5f7fb;--muted:#a2a8b4;--grad:linear-gradient(90deg,#6366f1,#a855f7,#ec4899);--radius:16px;--gap:14px;--pad:16px;--ring:0 0 0 2px rgba(99,102,241,.45)}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;background:var(--bg);color:var(--text);line-height:1.5}
    .container{max-width:1100px;margin:0 auto;padding:var(--pad)}

    /* ===== Topbar ===== */
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
    .brand{font-weight:800;font-size:1.25rem;background:var(--grad);-webkit-background-clip:text;color:transparent;letter-spacing:.2px}
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}

    /* ===== Hero ===== */
    .hero{margin:6px 0 20px;background:var(--surface-2);border-radius:20px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.06)}
    .headline{font-size:1.9rem;font-weight:900;background:var(--grad);-webkit-background-clip:text;color:transparent;letter-spacing:.25px;margin-bottom:6px}
    .sub{color:var(--muted);margin-top:6px}
    .hero-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
    .btn{padding:10px 16px;border-radius:12px;border:0;cursor:pointer;font-weight:800;transition:transform .15s ease}
    .btn:active{transform:scale(.98)}
    .btn.primary{background:var(--grad);color:#fff}
    .btn.secondary{background:#23252a;color:#e7e7ea;border:1px solid rgba(255,255,255,.12)}
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:16px}
    .stat{background:#1c1e24;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px;text-align:center}
    .stat .big{font-size:1.15rem;font-weight:800}
    .stat .small{font-size:.82rem;color:var(--muted)}

    /* ===== Horizontal App Row ===== */
    #app-grid{display:flex;gap:12px;overflow-x:auto;padding:4px 2px 10px;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch}
    #app-grid::-webkit-scrollbar{display:none}

    /* ===== Cards (compact) ===== */
    .card{flex:0 0 auto;min-width:190px;scroll-snap-align:start;position:relative;background:#1c1c21;padding:12px;border-radius:var(--radius);text-align:center;box-shadow:0 8px 22px rgba(0,0,0,.45);transition:.35s;opacity:0;transform:translateY(10px)}
    .card.show{opacity:1;transform:translateY(0)}
    .logo{width:56px;height:56px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,.08);margin:0 auto 10px}
    .name{font-size:.95rem;font-weight:800}
    .meta{font-size:.8rem;color:var(--muted);margin-top:2px}
    .pill{display:inline-block;margin-top:6px;font-size:.7rem;color:#e7e7ea;background:#26283a;border:1px solid rgba(255,255,255,.14);padding:3px 6px;border-radius:999px}
    .badge{position:absolute;left:10px;top:10px;font-size:.68rem;background:#26283a;border:1px solid rgba(255,255,255,.14);padding:2px 7px;border-radius:999px}

    /* ===== Download Row: horizontal & compact ===== */
    .btn-row{display:flex;gap:6px;align-items:center;justify-content:center;margin-top:8px;overflow-x:auto;padding-bottom:4px;white-space:nowrap;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .btn-row::-webkit-scrollbar{display:none}
    .btn-dl{display:inline-flex;align-items:center;justify-content:center;height:30px;padding:0 10px;border-radius:999px;text-decoration:none;font-weight:800;font-size:.82rem;background:#2a2d39;color:#e7e7ea;border:1px solid rgba(255,255,255,.14);transition:transform .15s ease, opacity .15s ease}
    .btn-dl:hover{transform:translateY(-1px);opacity:.95}
    .btn-dl.primary{background:var(--grad);color:#fff;border-color:transparent}

    /* ===== Skeleton ===== */
    .skeleton{position:relative;overflow:hidden;background:#222;border-radius:var(--radius)}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);animation:shine 1.2s infinite}
    @keyframes shine{to{transform:translateX(100%)}}
    .sk-card{padding:14px}
    .sk-avatar{width:56px;height:56px;border-radius:12px;margin:0 auto 10px}
    .sk-line{height:12px;border-radius:8px;margin:8px auto}
    .sk-btn{height:28px;border-radius:10px}

    footer{text-align:center;color:#7a7f8a;padding:18px;margin-top:22px;border-top:1px solid rgba(255,255,255,.08)}
    .offline{display:none;text-align:center;background:#241f1f;color:#f2dede;border:1px solid #5c3434;padding:8px;border-radius:10px;margin:10px 0}
    .offline.show{display:block}

    @media (max-width:760px){.headline{font-size:1.65rem}.stat .big{font-size:1.05rem}}
  </style>
</head>
<body>
  <h1 class="visually-hidden">GALAXY App Store – APKs</h1>
  <div class="container">
    <div class="topbar">
      <div class="brand">GALAXY App Store</div>
    </div>

    <div id="offlineBanner" class="offline">You are offline. Browsing cached UI.</div>

    <section class="hero">
      <div class="headline"> ដោនឡូត ភ្លាមៗ</div>
      <p class="sub"> APK MODMENU FILE TOOLS MediaFire/Cloud។</p>
      <div class="hero-actions">
        <button class="btn primary" id="scrollToApps">Browse Apps</button>
        <button class="btn secondary" id="sortToggle">Sort: Latest</button>
      </div>
      <div class="stats">
        <div class="stat"><div class="big" id="statCount">0+</div><div class="small">Apps</div></div>
        <div class="stat"><div class="big">1-click</div><div class="small">Download</div></div>
        <div class="stat"><div class="big">⚡</div><div class="small">Smooth UI</div></div>
      </div>
    </section>

    <main>
      <div id="message-area" style="text-align:center;margin:14px 0;color:#aaa">Loading apps…</div>
      <div id="app-grid"></div>
    </main>

    <footer>© 2025 GALAXY App Store. Made with ❤️</footer>
  </div>

  <script>
    // ===== Firebase =====
    const firebaseConfig={apiKey:"AIzaSyADlc_ZV7vdTQmdrpcYH1tRl05HU-898Kk",authDomain:"galaxyapkstore-5fb8a.firebaseapp.com",databaseURL:"https://galaxyapkstore-5fb8a-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"galaxyapkstore-5fb8a",storageBucket:"galaxyapkstore-5fb8a.firebasestorage.app",messagingSenderId:"122416439928",appId:"1:122416439928:web:8bbdc0a95ab7827b22c38d"};
    firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    const appGrid=document.getElementById('app-grid');
    const messageArea=document.getElementById('message-area');
    const statCount=document.getElementById('statCount');
    const sortToggle=document.getElementById('sortToggle');
    const offlineBanner=document.getElementById('offlineBanner');

    let allApps=[];let currentSort='latest';

    function updateOnline(){ offlineBanner.classList.toggle('show', !navigator.onLine); }
    window.addEventListener('online',updateOnline);window.addEventListener('offline',updateOnline);updateOnline();

    function setSkeleton(n=8){
      messageArea.style.display='block';
      appGrid.innerHTML = Array.from({length:n}).map(()=>`
        <div class="skeleton sk-card">
          <div class="sk-avatar"></div>
          <div class="sk-line" style="width:70%"></div>
          <div class="sk-line" style="width:40%"></div>
          <div class="sk-btn" style="width:100%;margin-top:8px"></div>
        </div>`).join('');
    }
    setSkeleton();

    db.collection('apps').onSnapshot(snap=>{
      allApps=[];
      if(snap.empty){messageArea.textContent='មិនទាន់មាន apps ទេ!';appGrid.innerHTML='';statCount.textContent='0';return;}
      snap.forEach(doc=>{
        const d=doc.data();
        allApps.push({
          id:doc.id,
          name:d.name||'Untitled',
          logoUrl:d.logoUrl||'https://via.placeholder.com/256?text=App',
          downloadLink:d.downloadLink||'#',
          version:d.version||'v1.0',
          size:d.size||'',
          category:d.category||'',
          updatedAt:d.updatedAt? (d.updatedAt.toDate? d.updatedAt.toDate(): new Date(d.updatedAt)) : null,
          links: Array.isArray(d.links) && d.links.length ? d.links : null
        });
      });
      statCount.textContent=allApps.length+"+";
      messageArea.style.display='none';
      render();
    },err=>{messageArea.textContent='សូមពិនិត្យការតភ្ជាប់ ឬ Firebase setup!'});

    function daysSince(date){ if(!date) return Infinity; const diff=Date.now()-date.getTime(); return Math.floor(diff/86400000); }
    function relDayLabel(date){ const d=daysSince(date); if(d===0) return 'today'; if(d===1) return '1 day ago'; if(d<30) return d+' days ago'; const m=Math.floor(d/30); return m+ (m>1?' months':' month') +' ago'; }

    function render(){
      let list=[...allApps];
      if(currentSort==='latest'){
        list.sort((a,b)=>{
          const at=a.updatedAt ? a.updatedAt.getTime() : 0;
          const bt=b.updatedAt ? b.updatedAt.getTime() : 0;
          return bt - at; // newest first
        });
      }else{
        list.sort((a,b)=>a.name.localeCompare(b.name));
      }
      displayApps(list);
    }

    const io=new IntersectionObserver((entries)=>{
      entries.forEach(en=>{ if(en.isIntersecting){ en.target.classList.add('show'); io.unobserve(en.target);} });
    },{root:null,threshold:.1});

    function sanitizeUrl(u){ try{ const url=new URL(u); return url.href; }catch(e){ return '#'; } }

    function displayApps(apps){
      appGrid.innerHTML='';
      if(apps.length===0){messageArea.textContent='រកមិនឃើញ app!';messageArea.style.display='block';return;}
      messageArea.style.display='none';
      const frag=document.createDocumentFragment();
      apps.forEach(app=>{
        const card=document.createElement('div');
        card.className='card';
        const isNew = daysSince(app.updatedAt) <= 14;
        const meta = [app.version, app.size].filter(Boolean).join(' • ');
        const cat = app.category ? `<span class="pill">${app.category}</span>` : '';
        const upd = app.updatedAt ? `<div class="meta">Updated ${relDayLabel(app.updatedAt)}</div>` : '';

        const links = (app.links && app.links.length)
          ? app.links.map(l=>({ label: l.label || 'Mirror', url: sanitizeUrl(l.url), primary: !!l.primary }))
          : [{ label:'Download', url: sanitizeUrl(app.downloadLink), primary: true }];

        const buttonsHtml = links.map(l => `
          <a class="btn-dl ${l.primary ? 'primary':''}" href="${l.url}" target="_blank" rel="noopener" aria-label="${l.label} ${app.name}">
            ${l.label}
          </a>
        `).join('');

        card.innerHTML=`
          ${isNew?'<span class="badge">NEW</span>':''}
          <img src="${app.logoUrl}" class="logo" alt="${app.name} logo" loading="lazy">
          <div class="name">${app.name}</div>
          <div class="meta">${meta || '—'}</div>
          ${cat}
          ${upd}
          <div class="btn-row">${buttonsHtml}</div>`;

        frag.appendChild(card); io.observe(card);
      });
      appGrid.appendChild(frag);
    }

    // Events
    sortToggle.addEventListener('click',()=>{
      currentSort=currentSort==='latest'?'az':'latest';
      sortToggle.textContent='Sort: '+(currentSort==='latest'?'Latest':'A–Z');
      render();
    });
    document.getElementById('scrollToApps').addEventListener('click',()=>{
      document.getElementById('app-grid').scrollIntoView({behavior:'smooth'})
    });
  </script>
</body>
</html>
